<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.1.4/dist/mindar-image.prod.js"></script>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.1.4/dist/mindar-image-aframe.prod.js"></script>
  <script src="https://rawgit.com/mayognaise/aframe-gif-shader/master/dist/aframe-gif-shader.min.js"></script>
  <!-- Quelle: https://jsfiddle.net/Lwtzjnk9/1/ für png sequenzen -->
  <script>
    AFRAME.registerComponent("animate-png", {
      init: function() {
        // load the .pngs
        let loader = new THREE.TextureLoader()
        this.pngArray = []

        //for-schleife
        let anim_frames = 54;
        for(var i = 1; i <= anim_frames; i++) {
          if(i < 10) {
            this.pngArray.push(loader.load("./animate_png/8359_2000" + i + ".png"))

          }
          this.pngArray.push(loader.load("./animate_png/8359_200" + i + ".png"))

        }

        this.el.addEventListener('loaded', e => {
          let mesh = this.el.getObject3D("mesh")
          this.material = mesh.material

          var i = 0
          this.id = setInterval(e => {
            if (i >= this.pngArray.length) i = 0;
            this.material.map = this.pngArray[i++]
            this.material.needsUpdate = true
          }, 100)
        })
      },
      remove: function() {
        clearInterval(this.id);
        // free the memory
        for (let i = 0; i < this.pngArray.length; i++) {
          this.pngArray[i].dispose();
        }
      }
    })

  </script>
</head>
<body>



<a-scene mindar-image="imageTargetSrc: ./targets.mind;" vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
  <a-assets>
    <img id="card" src="./8359_BG2.png" />
    <img id="waschbaer" src="./8359.gif" />
    <img id="pusheen" src="./pusheen.gif" />

    <video id="vid" src="./8359_2.mp4" autoplay="true" loop="true"> </video>


  </a-assets>
  <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>


  <a-entity mindar-image-target="targetIndex: 0">
    <!-- PNG SEQUENZ
    <a-image position="-0.5 -0.42 0.3"  scale="2 2 2" src="#card" animate-png></a-image>
    -->

    <!-- Video test , läuft noch nicht
      <a-video src="#vid" position="0.5 0.5 0.5" autoplay="true" loop="true"> </a-video>
    -->
    <a-entity geometry="primitive:plane;" scale="1 1.5 1" position="0 0 0.2" material="shader:gif;src:#waschbaer;alphaTest:0.5;" transparent="false" gif="" rotation="" scale="" visible="" geometry=""></a-entity>
  </a-entity>

  <a-entity mindar-image-target="targetIndex: 1">
    <a-entity geometry="primitive:plane;" scale="1 1.5 1" position="0 0 0.2" material="shader:gif;src:#waschbaer;alphaTest:0.5;" transparent="false" gif="" rotation="" scale="" visible="" geometry=""></a-entity>
  </a-entity>
</a-scene>


</body>
</html>