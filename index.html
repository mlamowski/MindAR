<html>
<head>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <script src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.1.4/dist/mindar-image.prod.js"></script>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="/path/to/howler.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.1.4/dist/mindar-image-aframe.prod.js"></script>
  <script src="https://rawgit.com/mayognaise/aframe-gif-shader/master/dist/aframe-gif-shader.min.js"></script>
  <script src="https://rawgit.com/mayognaise/aframe-video-shader/master/dist/aframe-vid-shader.min.js"></script>
  <script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/v4.1.2/dist/aframe-extras.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!-- Quelle: https://jsfiddle.net/Lwtzjnk9/1/ fÃ¼r png sequenzen -->

</head>
<body>



<a-scene mindar-image="imageTargetSrc: ./targets.mind;" vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
  <a-assets>
    <img id="card" src="./8359_BG2.png" />
    <img id="ballon" src="./8359.gif" />
    <img id="dancebaer" src="./8435.gif" />
    <img id="lovers" src="./8406A.gif" />
    <img id="8406A" src="./8406A.jpg" />
    <img id="8435" src="./8435.jpg" />
    <img id="pusheen" src="./pusheen.gif" />
    <audio id="sound" src="wee-sound-effect.mp3" autoplay loop playsinline webkit-playsinline muted></audio>
    <a-asset-item id="rechteck" src="./bones_test2.gltf"></a-asset-item>
    <video id="lovers_vid" src="./8406A.mp4" crossorigin="anonymous" muted playsinline webkit-playsinline> </video>
    <video id="lovers_lowres" src="./8406A_lowres.mp4" crossorigin="anonymous" muted playsinline webkit-playsinline> </video>


    <video
            id="soccer"
            crossOrigin="anonymous"
            src="https://rawcdn.githack.com/gftruj/webzamples/b500ecb2171e288ae6a14a917816d300a6d374c3/aframe/assets/videos/soccer/soccer1.webm"
            preload="auto"
            autoPlay
            loop="true"
    ></video>

    <video
            id="test"
            crossOrigin="anonymous"
            src="./8406A_lowres.webm"
            preload="auto"
            autoPlay
            loop="true"
    ></video>



  </a-assets>
  <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

  <a-entity mindar-image-target="targetIndex: 0" >
    <!-- <a-gltf-model rotation="0 0 0 " position="0 -0.25 0.3" src="#rechteck" animation-mixer=""> -->
    <!-- <a-entity geometry="primitive:plane;" scale="1 1.5 1" position="0 0 0.2" material="shader:gif;src:#ballon;alphaTest:0.5;" transparent="false" gif="" rotation="" scale="" visible="" geometry="" ></a-entity> -->
    <a-video
            play-on-click
            alpha-video
            width="1.32"
            height="1"
            rotation="270 0 0"
            position="0 0.14 0"
            src="#soccer"
            material="transparent: true"
    ></a-video>
  </a-entity>

  <a-entity mindar-image-target="targetIndex: 1">
    <!-- <a-video src="#lovers_vid" scale="1 1.5 1" position="0 0 0.2" > </a-video> -->
    <a-video
            play-on-click
            alpha-video
            width="1.32"
            height="1"
            rotation="270 0 0"
            position="0 0.14 0"
            src="#test"
            material="transparent: true"
    ></a-video>  </a-entity>

  <a-entity id="example-target" mindar-image-target="targetIndex: 2">
    <a-video src="#lovers_lowres" scale="1 1.5 1" position="0 0 0.2" > </a-video>
    <!-- <a-entity geometry="primitive:plane;" scale="1 1.5 1" position="0 0 0.2" material="shader:gif;src:#dancebaer;alphaTest:0.5;" transparent="false" gif="" rotation="" scale="" visible="" geometry="" ></a-entity> -->
    <!-- <a-sound src="#sound"></a-sound> -->
  </a-entity>
</a-scene>

<script>
  // detect target found

  const myTarget = document.getElementById("example-target");
  const vid = document.getElementById("lovers_lowres");

  myTarget.addEventListener("targetFound", event => {
    console.log("target found");
    vid.play();
    vid.muted = false;
  });
  // detect target lost
  myTarget.addEventListener("targetLost", event => {
    console.log("target lost");
    vid.muted = true;
    vid.pause();
  });
  const myTarget2 = document.getElementById("example-target2");
  const vid2 = document.getElementById("lovers_vid2");

  myTarget2.addEventListener("targetFound", event => {
    console.log("target found");
    vid2.play();
    vid2.muted = false;
  });
  // detect target lost
  myTarget2.addEventListener("targetLost", event => {
    console.log("target lost");
    vid2.muted = true;
    vid2.pause();
  });



  AFRAME.registerComponent("alpha-video", {
    init: function() {
      this.materialLoaded = this.materialLoaded.bind(this);
      console.log("init");
      // wait until the material is ready
      this.el.addEventListener("loaded", this.materialLoaded);
    },
    materialLoaded: function() {
      // grab the material
      let material = this.el.getObject3D("mesh").material;
      console.log(material.map.format);

      // swap the format
      material.map.format = THREE.RGBAFormat;
      material.map.needsUpdate = true;
      console.log(material.map);
    },
    remove: function() {
      this.el.removeEventListener("loaded", this.materialLoaded);
    }
  });
  // clickable
  AFRAME.registerComponent("play-on-click", {
    init: function() {
      document.body.addEventListener("click", e => {
        const src = this.el.getAttribute("src");
        document.querySelector(src).play();
      });
    }
  });
</script>

</body>
</html>